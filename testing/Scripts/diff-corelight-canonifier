#! /usr/bin/env bash

if [ "$(uname)" == "Linux" ]; then
    sed="sed -r"
else
    sed="sed -E"
fi

# Replace anything which looks like timestamps with XXXs (including the #start/end markers in logs).
sed -E 's/(0\.000000)|([0-9]{9,10}\.[0-9]{2,8})/XXXXXXXXXX.XXXXXX/g' |
    sed -E 's/^ *#(open|close).(19|20)..-..-..-..-..-..$/#\1 XXXX-XX-XX-XX-XX-XX/g' |

    # Replace absolute paths with the basename.
    $sed 's#/+#/#g' |
    $sed 's#/([^	 :/]{1,}/){1,}([^	 :/]{1,})#<...>/\2#g' |

    # Remove broker endpoint ids
    sed -r -e 's/id=[0-9a-f\-]+,/id=REMOVED-UUID,/g' |

    # Remove broker endpoint addresses
    sed -r -e 's/address=[0-9\.]+,/address=REMOVED-ADDRESS,/g' |

    # Remove some other weird broker error
    grep -v 'Reporter::ERROR	Broker error (Broker::PEER_UNAVAILABLE): (00000000-0000-0000-0000-000000000000' |

    # Remove line numbers from reporter
    sed -E 's/, line [0-9]+$//g' |
    sed -E 's/, lines [0-9]+-[0-9]+$//g'
